# give default app here
ifeq ($(app),)
app = vadd_vv_i32
endif

# give default app type here: test or demo ?
ifeq ($(type),)
type = test
endif

BARE_APP_DIR = $(PROJ_ROOT)/$(type)

OUTPUT_HOST_BIN_DIR = $(RISCV_ROOT)/software/host/bin
runbeak = $(OUTPUT_HOST_BIN_DIR)/spike

OUTPUT_TARGET_BIN_DIR = $(PROJ_ROOT)/bin

gorun = $(PROJ_ROOT)/scripts/gorun.sh

app-elf = $(OUTPUT_TARGET_BIN_DIR)/$(type)/$(app).elf

all: info rbb

info	:
	@echo ""
	@echo " target	:	deccription"
	@echo "****************************"
	@echo " bare	:	build application on baremental case. param: type=app-type app=app-name"
	@echo ""
	@echo " rbb	:	run bare-app on beak. (build it firstly if modified) param: APP_TYPE=type APP_NAME=app-name , bp=beak-param"
	@echo ""
	@echo " clean		:	delete objects generated by make"
	@echo "****************************"
	@echo ""

bare	:
	$(gorun) $(BARE_APP_DIR) "make -j$(shell nproc) APP_TYPE=$(type) APP_NAME=$(app)"

bare-clean	:
	$(gorun) $(BARE_APP_DIR) "make APP_TYPE=$(type) APP_NAME=$(app) clean"

clean	: bare-clean

rbb	: bare
	$(runbeak) $(bp) --isa=rv32IMC ++set_orv32_rst_pc=80000000 ++$(app-elf) ++load_pk
